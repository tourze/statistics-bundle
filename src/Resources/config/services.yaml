services:
  # default configuration for services in *this* file
  _defaults:
    autowire: true      # Automatically injects dependencies in your services.
    autoconfigure: false # 禁用全局自动配置，测试数据加载器在环境特定配置中注册

  # 显式注册 Controller 并开启必要的服务功能
  StatisticsBundle\Controller\:
    resource: '../../Controller/'
    public: true
    autoconfigure: true
    tags: ['controller.service_arguments']

  # 自动注册 Service 目录下的所有服务
  StatisticsBundle\Service\:
    resource: '../../Service/'
    autoconfigure: true

  # 自动注册 MessageHandler 目录下的所有消息处理器
  StatisticsBundle\MessageHandler\:
    resource: '../../MessageHandler/'
    autoconfigure: true
    tags: ['messenger.message_handler']

  # 手动配置命令服务，明确指定所有依赖
  StatisticsBundle\Command\GenerateDailyReportCommand:
    autoconfigure: true
    arguments:
      $dailyReportService: '@StatisticsBundle\Service\DailyReportService'
    tags:
      - { name: 'console.command' }

  StatisticsBundle\Command\StatsTableCommand:
    autoconfigure: true
    arguments:
      $entityManager: '@doctrine.orm.entity_manager'
      $connection: '@doctrine.dbal.default_connection'
      $messageBus: '@messenger.default_bus'
    tags:
      - { name: 'console.command' }
    public: true

  # 手动注册 DailyReportService
  StatisticsBundle\Service\DailyReportService:
    arguments:
      $entityManager: '@doctrine.orm.entity_manager'

  # Repository 服务 - 使用标准的 Doctrine Repository 配置
  StatisticsBundle\Repository\DailyReportRepository:
    tags: ['doctrine.repository_service']

  StatisticsBundle\Repository\DailyMetricRepository:
    tags: ['doctrine.repository_service']

  # 接口别名
  StatisticsBundle\Contract\DailyReportStorageInterface: '@StatisticsBundle\Repository\DailyReportRepository'
